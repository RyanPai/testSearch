(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{175:function(e,t,n){"use strict";(function(e){var a=n(101),i=n(100),o=n(176),l=n(177),s=n(196),c=n(178),r=n(195),d=n(16),u=n(179),h=n(0),p=n.n(h),m=n(180),f=n.n(m),g=n(181),w=n.n(g),v=n(182),y=n.n(v),E=(n(278),n(62)),b=n.n(E),k=n(98),I=n.n(k),O=n(97),j=n.n(O),S=n(192),x=n.n(S),C=n(194),P=n.n(C),T=n(22),D=n.n(T),A=n(193),Z=n.n(A),F=n(99),M=n.n(F),L=n(186),B=n.n(L),q=n(188),z=n.n(q),N=n(60),U=n.n(N),V=n(189),_=n.n(V),G=n(61),J=n.n(G),K=n(59),W=n.n(K),X=n(93),Q=n.n(X),$=n(183),H=n(191),R=n.n(H),Y=n(96),ee=n(190),te=n.n(ee);function ne(){var e=Object(u.a)(["","",""]);return ne=function(){return e},e}var ae=$.a.div(ne(),Y.spacing,Y.palette),ie=function(t){function n(e){var t;return Object(o.a)(this,n),(t=Object(s.a)(this,Object(c.a)(n).call(this,e))).state={isSigin:!1,files:[],childrens:[],series:{},searchMethod:"input",inputText:"",downloadType:{product:!0,upc:!1},downloadDone:!1,searchItem:{},downloadLoading:!1,percen:0,url:"",base64:"",pdf:""},t.loadClient=t.loadClient.bind(Object(d.a)(Object(d.a)(t))),t.loadFiles=t.loadFiles.bind(Object(d.a)(Object(d.a)(t))),t.loadSeries=t.loadSeries.bind(Object(d.a)(Object(d.a)(t))),t.seriesInit=t.seriesInit.bind(Object(d.a)(Object(d.a)(t))),t.onDownloadZIP=t.onDownloadZIP.bind(Object(d.a)(Object(d.a)(t))),t.downloadData=t.downloadData.bind(Object(d.a)(Object(d.a)(t))),t.onSaveFileZIP=t.onSaveFileZIP.bind(Object(d.a)(Object(d.a)(t))),t}return Object(r.a)(n,t),Object(l.a)(n,[{key:"componentDidMount",value:function(){window.gapi.load("client:auth2",this.initClient.bind(this))}},{key:"initClient",value:function(){window.gapi.client.init({apiKey:"AIzaSyAAKJOAw6uBXpKhpAkXQy0e0pPFxpNMraM",clientId:"1090032071436-ejoeke6m3hupc8i8p41u6tf2pl1scmld.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.metadata.readonly https://www.googleapis.com/auth/drive.photos.readonly https://www.googleapis.com/auth/drive.readonly"}).then(function(){},function(e){console.log(e)})}},{key:"updateSigninStatus",value:function(e){console.log(e)}},{key:"authenticate",value:function(){return window.gapi.auth2.getAuthInstance().signIn({scope:"https://www.googleapis.com/auth/drive.metadata.readonly https://www.googleapis.com/auth/drive.photos.readonly https://www.googleapis.com/auth/drive.readonly"}).then(function(){console.log("Sign-in successful")},function(e){console.error("Error signing in",e)})}},{key:"loadClient",value:function(){var e=this;return window.gapi.client.load("https://content.googleapis.com/discovery/v1/apis/drive/v2/rest").then(function(){console.log("GAPI client loaded for API"),e.setState({isSigin:!0})},function(e){console.error("Error loading GAPI client for API",e)})}},{key:"handleAuthClick",value:function(e){window.gapi;this.authenticate().then(this.loadClient)}},{key:"loadFiles",value:function(){var e=this;window.gapi.client.drive.files.list({}).then(function(t){e.setState({files:Object(i.a)(t.result.items)})},function(e){console.error("Execute error",e)})}},{key:"loadSeries",value:function(e){var t=this,n=window.gapi;n.client.drive.files.list({q:"'".concat(e,"' in parents")}).then(function(e){e.result.items.map(function(e){n.client.drive.files.list({q:"'".concat(e.id,"' in parents")}).then(function(n){n.result.items.length&&(n.result.type=e.title,t.state.childrens=[].concat(Object(i.a)(t.state.childrens),[n.result]),t.seriesInit())},function(e){console.error("Execute error",e)})})},function(e){console.error("Execute error",e)})}},{key:"seriesInit",value:function(){var e=this,t=this.state.childrens;t.length>=2&&t.map(function(t){t.items.map(function(n){e.state.series[n.title]=e.state.series[n.title]||{},e.state.series[n.title]["UPC"==t.type?"upc":"product"]=n.id})})}},{key:"onDownloadZIP",value:function(){var e=this,t=window.gapi,n=this.state,a=n.searchMethod,i=n.downloadType;(this.setState({downloadLoading:!0,downloadDone:!1,percen:0,hint:""}),this.state.searchItem={},"input"==a)?this.state.inputText.split(/[\n||,]/).map(function(e){return e.split(/[-_\/]/)}).map(function(n,a){if(n[0]){var o=n.join("-");e.state.searchItem[o]={data:[]};var l="fullText contains '".concat(n[0],"'");n.map(function(e,t){t>0&&(l+=" and fullText contains '".concat(e,"'"))}),setTimeout(function(){t.client.drive.files.list({q:l}).then(function(t){e.state.searchItem[o].items=t.result.items.filter(function(e){return i.product&&i.upc&&("pdf"==e.fileExtension||"jpg"==e.fileExtension||"jpeg"==e.fileExtension||"png"==e.fileExtension)?e:i.product&&e.fileExtension&&"pdf"!=e.fileExtension?"pdf"!=e.fileExtension:!(!i.upc||!e.fileExtension||"pdf"!=e.fileExtension)&&"pdf"==e.fileExtension}),e.state.searchItem[o].items.map(function(t){e.downloadData({key:o,url:t.downloadUrl,type:t.fileExtension,title:t.title})}),t.result.items.length&&e.state.searchItem[o].items.length||(e.state.searchItem[o].done=!0,e.state.searchItem[o].status="fail",e.onSaveFileZIP())},function(e){console.error("Execute error",e)})},90*a)}}):console.log(this.state.searchItem)}},{key:"downloadData",value:function(t){var n=this,a=t.key,i=t.url,o=t.type,l=t.title,s=window.gapi;f()({method:"get",responseType:"arraybuffer",url:i,headers:{Authorization:"".concat(s.auth.getToken().token_type," ").concat(s.auth.getToken().access_token)}}).then(function(t){var i;i="pdf"==o?new Blob([t.data],{type:"application/pdf"}):new e(t.data,"binary").toString("base64"),n.state.searchItem[a].data.push({data:i,type:o,key:a,title:l}),n.state.searchItem[a].items.length==n.state.searchItem[a].data.length&&(n.state.searchItem[a].done=!0,n.onSaveFileZIP())})}},{key:"onSaveFileZIP",value:function(){var e=this,t=this.state.searchItem,n=Object.keys(t).map(function(e){return e}),a=Object.keys(t).filter(function(e){return t[e].done});if(this.setState({percen:Math.ceil(a.length/n.length*100)}),console.log(n.length,a.length),n.length==a.length){console.log("start down zip"),this.setState({hint:"Zip Compressing"});var i=new y.a;Object.keys(t).map(function(e){t[e].data.map(function(e){var t=i.folder(e.key);"pdf"==e.type?t.file(e.title,e.data,{binary:!0}):t.file(e.title,e.data,{base64:!0})})}),Object.keys(i.files).length?i.generateAsync({type:"blob"}).then(function(t){w.a.saveAs(t,"OVVO_Product.zip"),e.setState({downloadLoading:!1,downloadDone:!0})}):(alert("Nothing download"),this.setState({downloadLoading:!1,downloadDone:!0}))}}},{key:"onSearchMethod",value:function(e){this.setState({searchMethod:e.target.value})}},{key:"onInputChange",value:function(e){this.setState({inputText:e.target.value})}},{key:"onSeriesChecked",value:function(e,t){var n=this.state.series;n[e].checked=t.target.checked,this.setState({series:Object(a.a)({},n)})}},{key:"onDownloadType",value:function(e,t){var n=this.state.downloadType;n[e]=t.target.checked,this.setState({downloadType:Object(a.a)({},n)})}},{key:"render",value:function(){var e=this;window.gapi;return p.a.createElement("div",{className:"App root"},p.a.createElement(B.a,{position:"static",color:"default"},p.a.createElement(z.a,null,p.a.createElement(Q.a,{variant:"h6",color:"inherit"},"OVVO Product / UPC Finder"))),!this.state.isSigin&&p.a.createElement(ae,{p:2},p.a.createElement(U.a,null,p.a.createElement(J.a,null,"Log in to Google Drive"),p.a.createElement(_.a,null,p.a.createElement(W.a,{variant:"contained",color:"primary",onClick:this.handleAuthClick.bind(this)},"Log in")))),this.state.isSigin&&p.a.createElement(ae,{p:2},this.state.downloadLoading&&p.a.createElement("div",null,p.a.createElement("br",null),p.a.createElement(te.a,{variant:"query"}),p.a.createElement("br",null),"".concat(this.state.percen,"% ").concat(this.state.hint)),p.a.createElement(U.a,null,p.a.createElement(J.a,null,p.a.createElement(b.a,{container:!0,spacing:24},p.a.createElement(b.a,{item:!0,xs:12},p.a.createElement(R.a,{id:"outlined-multiline-flexible",label:"Model name / model color",multiline:!0,rowsMax:"10",value:this.state.inputText,onChange:this.onInputChange.bind(this),margin:"normal",variant:"outlined",style:{width:"100%"}})),p.a.createElement(b.a,{item:!0,xs:12},p.a.createElement(j.a,{control:p.a.createElement(I.a,{checked:this.state.downloadType.product,value:"product",color:"primary",onChange:this.onDownloadType.bind(this,"product")}),label:"Product Image"}),p.a.createElement(j.a,{control:p.a.createElement(I.a,{checked:this.state.downloadType.upc,value:"upc",color:"primary",onChange:this.onDownloadType.bind(this,"upc")}),label:"UPC"}))))),p.a.createElement(U.a,null,p.a.createElement(J.a,null,p.a.createElement(W.a,{disabled:this.state.downloadLoading,variant:"contained",color:"primary",onClick:this.onDownloadZIP},"Download ZIP")),this.state.downloadDone&&p.a.createElement(x.a,null,p.a.createElement(Z.a,null,p.a.createElement(M.a,null,p.a.createElement(D.a,null,"folder Name"),p.a.createElement(D.a,null,"Status"),p.a.createElement(D.a,{align:"right"},"Itmes"),p.a.createElement(D.a,{align:"right"},"Total"))),p.a.createElement(P.a,null,Object.keys(this.state.searchItem).map(function(t){return p.a.createElement(M.a,{key:t},p.a.createElement(D.a,{component:"th",scope:"row"},t),p.a.createElement(D.a,{component:"th",scope:"row"},e.state.searchItem[t].status||"success"),p.a.createElement(D.a,{align:"right"},e.state.searchItem[t].data.map(function(e,t){return p.a.createElement("div",{key:t},e.title)})),p.a.createElement(D.a,{align:"right"},e.state.searchItem[t].data.length))}))))))}}]),n}(h.Component);t.a=ie}).call(this,n(29).Buffer)},201:function(e,t,n){e.exports=n(444)},206:function(e,t,n){},230:function(e,t){},232:function(e,t){},278:function(e,t,n){},444:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),o=n(17),l=n.n(o),s=(n(206),n(175));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(s.a,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[201,2,1]]]);
//# sourceMappingURL=main.0c3e2715.chunk.js.map